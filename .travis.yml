language: node_js
before_install: cd adaptive-arp-ts
node_js:
- '0.12'
install:
- npm install -g typescript
- npm install -g replace
before_script: 
- export HOME=`pwd`
- export TIMESTAMP=`date`
- export CURRENT_TAG=`git describe --abbrev=0`
- mkdir -p .git
- git config --global credential.helper "store --file=$HOME/.git/credentials"
- git config --global user.email "carlos@adaptive.me"
- git config --global user.name "carloslozano"
- git config --global push.default simple
- echo "https://${GH_TOKEN}:@github.com" > $HOME/.git/credentials
script:
- ./compile.sh
after_success:
    if [ "$TRAVIS_BRANCH" == "$TRAVIS_TAG" ] && [ "$TRAVIS_PULL_REQUEST" == "false" ]; then

    elif [ "$TRAVIS_PULL_REQUEST" == "false" ]; then
    
        export SOURCE_HOME=`pwd`
        
        mkdir -p temp
        
        cd temp
        
        git clone https://github.com/AdaptiveMe/adaptive-arp-api.git
        
        cd adaptive-arp-api
        
        export API_TAG=`git describe --abbrev=0`
        
        export API_TAG=`echo ${API_TAG//[v]/ }`
        
        rm -Rf temp
        
        cd $SOURCE_HOME
        
        git remote set-url origin git@github.com:AdaptiveMe/adaptive-arp-typescript.git
        
        if [ "$GIT_TAG" != "$API_TAG" ]; then
        
            git tag -a "${API_TAG}" -m "API Specification ${API_TAG}"
            
            git push origin HEAD:master --tags
            
        fi
        
    fi
    
after_failure:
- echo "Having a bad moment..."
env:
  global:
    secure: LFHO9dsUi1A+0WHXwFPXeHfiJirmQyjw5h9K9cIPjyCM2E9ao6qEiLwCamXdSJg9oL4A0sgQiQCYZgFznyxJ4n3TM5gDR8dAZvueogdG5BcLeFZts5PpL4iU90OXDBAz/ElBMr2CA1toVpbXYp6aB1yGDaqt6cXUty/5U8KoB1s=
